<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrognosticAI Enabled</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #F0F4F8;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        #typed-output {
            font-size: 24px;
            width: 100%;
            text-align: left;
            font-weight: 300;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        #typed-output {
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    #typed-output h1, #typed-output h2, #typed-output h3 {
        margin-top: 10px;
        margin-bottom: 5px;
    }
    #typed-output h1 { font-size: 28px; }
    #typed-output h2 { font-size: 24px; }
    #typed-output h3 { font-size: 20px; }
</style>

<script>
    let typedInstance = null;
    let fetchInProgress = false;
    let streak = 0;

    function fetchAndDisplayText() {
        if (fetchInProgress) return;
        fetchInProgress = true;

        fetch('https://prognostic-backend-44804a264069.herokuapp.com/getText')
            .then(response => response.json())
            .then(data => {
                if (data.text && (!typedInstance || typedInstance.strings[0] !== data.text)) {
                    if (typedInstance) {
                        typedInstance.destroy();
                    }
                    createFireworks();
                    streak++;
                    updateStreak();

                    document.getElementById('typed-output').innerHTML = data.text;

                    setTimeout(() => {
                        document.getElementById('fireworks-container').innerHTML = '';
                    }, 4000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('typed-output').innerHTML = 'Error fetching AI response. Please try again.';
                streak = 0;
                updateStreak();
            })
            .finally(() => {
                fetchInProgress = false;
            });
    }

        function updateStreak() {
            const streakCounter = document.getElementById('streak-counter');
            streakCounter.innerHTML = `Streak: ${streak} ðŸ”¥`;
            streakCounter.classList.add('visible');
            setTimeout(() => {
                streakCounter.classList.remove('visible');
            }, 1500);
        }

        function createFireworks() {
            const container = document.getElementById('fireworks-container');
            container.innerHTML = '';
            const colors = ['#FF00FF', '#A020F0', '#8A2BE2', '#9400D3', '#9370DB', '#7B68EE', '#6A5ACD', '#FFD700', '#FFA500', '#FF4500'];
            
            const textBox = document.getElementById('typed-output');
            const rect = textBox.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    createFirework(container, colors, centerX, centerY);
                }, i * 100);
            }
        }

        function createFirework(container, colors, x, y) {
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = `${x + (Math.random() - 0.5) * 300}px`;
            firework.style.top = `${y + (Math.random() - 0.5) * 200}px`;
            firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            container.appendChild(firework);

            for (let j = 0; j < 60; j++) {
                const spark = document.createElement('div');
                spark.className = 'spark';
                spark.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                spark.style.left = firework.style.left;
                spark.style.top = firework.style.top;
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                spark.style.setProperty('--tx', `${Math.cos(angle) * distance}px`);
                spark.style.setProperty('--ty', `${Math.sin(angle) * distance}px`);
                container.appendChild(spark);
            }
        }

        fetchAndDisplayText();
        setInterval(fetchAndDisplayText, 10000);
    </script>
</body>
</html>
