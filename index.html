<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrognosticAI Enabled</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <style>
    body {
        font-family: 'Montserrat', sans-serif;
        background-color: #F0F4F8;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        box-sizing: border-box;
    }

    #typed-output {
        font-size: 18px;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        transition: all 0.3s ease;
        box-sizing: border-box;
        line-height: 1.6;
    }

    .result-header {
        background-color: #0142AC;
        color: white;
        padding: 20px;
        border-radius: 15px 15px 0 0;
        margin-bottom: 0;
        text-align: center;
    }

    .result-content {
        background-color: white;
        border-radius: 0 0 15px 15px;
        padding: 25px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .column {
        flex-basis: calc(50% - 20px);
        margin-bottom: 20px;
    }

    .section {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .highlight-box {
        background-color: #e9ecef;
        border-left: 5px solid #0142AC;
        padding: 20px;
        margin: 20px 0;
        border-radius: 0 10px 10px 0;
    }

    .action-item {
        display: flex;
        align-items: flex-start;
        margin: 20px 0;
        padding: 15px;
        background-color: #f0f4f8;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .action-item:before {
        content: 'âœ…';
        margin-right: 15px;
        font-size: 24px;
        flex-shrink: 0;
    }

    .demo-button {
        display: inline-block;
        background-color: #0142AC;
        color: white;
        font-size: 18px;
        padding: 15px 30px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        transition: all 0.3s ease;
        text-align: center;
        margin: 40px auto 20px;
        animation: buttonAppear 0.5s ease-out, pulse 2s infinite;
    }

    .demo-button:hover {
        background-color: #0056d6;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(1, 66, 172, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(1, 66, 172, 0); }
        100% { box-shadow: 0 0 0 0 rgba(1, 66, 172, 0); }
    }

    @media (max-width: 768px) {
        .column {
            flex-basis: 100%;
        }
    }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading" style="display: none;">Analyzing...</div>
        <div id="typed-output"></div>
    </div>
    
    <script>
    let typedInstance = null;
    const API_BASE = window.location.hostname === 'localhost' 
        ? 'http://localhost:3000' 
        : 'https://prognosticai-11cf2622005a.herokuapp.com';

    function fetchAndDisplayText() {
        console.log('Fetching and displaying text');
        const typedOutput = document.getElementById('typed-output');
        
        typedOutput.style.opacity = '0';
        
        const loadingMessages = [
            "Psychoanalyzing your inner workings...",
            "Uncovering hidden patterns in your responses...",
            "Identifying archetypal anomalies...",
            "Delving into the deep dark depths of your hidden psyche...",
            "Forging a window into your mind and future...",
            "Mapping your synaptic space... illustrating your mind's landscape..."
        ];
        const randomMessage = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
        console.log(`Displaying loading message: ${randomMessage}`);
        typedOutput.innerHTML = randomMessage;
        
        typedOutput.style.opacity = '0';
        
        console.log(`Fetching from ${API_BASE}/getText`);
        fetch(`${API_BASE}/getText?t=${Date.now()}`)
        .then(response => {
            console.log(`Received response with status: ${response.status}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log("Received data:", data);
            if (data.text) {
                console.log("Content received, updating display");
                typedOutput.style.opacity = '0';
                setTimeout(() => {
                    typedOutput.innerHTML = '';
                    if (typedInstance) {
                        console.log("Destroying previous Typed instance");
                        typedInstance.destroy();
                    }
                    console.log("Enhancing content");
                    const enhancedContent = enhanceContent(data.text);
                    console.log("Creating new Typed instance");
                    typedInstance = new Typed(typedOutput, {
                        strings: [enhancedContent],
                        typeSpeed: 5,
                        showCursor: false,
                        contentType: 'html',
                        onComplete: function() {
                            console.log("Typing complete");
                        }
                    });
                    typedOutput.style.opacity = '1';
                }, 300);
            } else {
                console.log("No content received");
                typedOutput.innerHTML = 'No content available. Please try again later.';
                typedOutput.style.opacity = '1';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            typedOutput.innerHTML = 'Error fetching AI response. Please try again later.';
            typedOutput.style.opacity = '1';
        });
    }

    function enhanceContent(content) {
        content = `<div class="result-header"><h1>Your Marketing Strategy Insights</h1></div><div class="result-content">`;
        
        // Split content into sections
        const sections = content.split(/Key Insight #\d+:/);
        sections.shift(); // Remove the empty first element

        // Create two columns
        let column1 = '<div class="column">';
        let column2 = '<div class="column">';

        sections.forEach((section, index) => {
            const sectionContent = `
                <div class="section">
                    <h2>Key Insight #${index + 1}:</h2>
                    ${processSection(section)}
                </div>
            `;

            if (index % 2 === 0) {
                column1 += sectionContent;
            } else {
                column2 += sectionContent;
            }
        });

        column1 += '</div>';
        column2 += '</div>';

        content += column1 + column2;
        
        // Add the demo button
        content += `<div class="button-container"><a href="https://prognostic.ai/#demo" class="demo-button" id="demoButton">Book Your Free Demo Now!</a></div>`;
        
        content += '</div>';
        return content;
    }

    function processSection(sectionContent) {
        // Handle highlight boxes
        sectionContent = sectionContent.replace(/(Imagine for a second.*?)\n/g, '<div class="highlight-box">$1</div>');
        
        // Handle action items
        sectionContent = sectionContent.replace(/Here's how.*?:/g, '<div class="action-item">$&</div>');
        
        // Handle unordered lists
        sectionContent = sectionContent.replace(/\n- (.*?)(?=\n|$)/g, '<ul><li>$1</li></ul>');
        
        // Handle ordered lists
        sectionContent = sectionContent.replace(/\n\d+\. (.*?)(?=\n|$)/g, '<ol><li>$1</li></ol>');
        
        return sectionContent;
    }

    // Fetch and display text once when the page loads
    fetchAndDisplayText();
    </script>
</body>
</html>
